<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Power</title>
    <!-- é€£çµå¤–éƒ¨ CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="menu">
        <h1>æ­¡è¿ä½¿ç”¨ Word Power</h1>
        <p>-------------------------------------------</p>
        <p>1. ç·´ç¿’ 7000 å–®å­—</p>
        <p>2. é€€å‡º</p>
        <button onclick="selectOption(1)">é¸æ“‡ 1</button>
        <button onclick="selectOption(2)">é¸æ“‡ 2</button>
    </div>

    <div class="quiz-container" id="quiz-container" style="display:none;">
        <h2>é¸æ“‡ç·´ç¿’é¡å‹</h2>
        <button class="quiz-button" onclick="chooseQuizType('multiple-choice')">1. é¸æ“‡é¡Œ</button>
<button class="quiz-button" onclick="chooseQuizType('fill-in-the-blank')">2. å¡«ç©ºé¡Œ</button>

    </div>

    <div class="question-container" id="question-container" style="display:none;">
        <h2>è«‹è¼¸å…¥è¦ç­”çš„é¡Œæ•¸</h2>
        <input type="number" id="question-count" placeholder="é¡Œæ•¸" min="1" max="100" />
        <button class="quiz-button" onclick="startQuiz()">é–‹å§‹æ¸¬é©—</button>
    </div>

    <div class="quiz" id="quiz" style="display:none;">
        <div class="question" id="question">Loading...</div>
        <div class="answers" id="answers"></div>
        <div class="result" id="result"></div>
        <button id="next-btn" class="quiz-button"  style="display:none;">ä¸‹ä¸€é¡Œ</button>
        <button id="return-btn" class="quiz-button"  style="display:none;" onclick="returnToMenu()">å›ä¸»ç•«é¢</button>
    </div>

    <script>
        let words = [];
        let currentQuestionIndex = 0;
        let quizType = '';
        let totalQuestions = 0;

        // å¾ localStorage è®€å– CSV è³‡æ–™
        //const csvContent = localStorage.getItem('uploadedCSV');
        //if (csvContent) {
        //    const lines = csvContent.replace(/\r/g, '').split('\n').filter(line => line.trim() !== '');
        //    words = lines.map(line => {
        //        const [word, meaning] = line.split(',').map(v => v.trim());
        //        return { word, meaning };
        //    });
       // }

    async function loadCSVFromFile(fileName) {
        try {
            const response = await fetch("senior_7000.csv"); // ä½¿ç”¨ fetch å¾åŒç›®éŒ„è®€å–æª”æ¡ˆ
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const csvContent = await response.text(); // å–å¾—æª”æ¡ˆæ–‡å­—å…§å®¹
            const lines = csvContent.replace(/\r/g, '').split('\n').filter(line => line.trim() !== ''); // ç§»é™¤ç©ºè¡Œ
            words = lines.map(line => {
                const [word, meaning] = line.split(',').map(v => v.trim());
                return { word, meaning };
            });
            console.log("è¼‰å…¥å–®å­—è³‡æ–™ï¼š", words);
        } catch (error) {
            console.error("ç„¡æ³•è®€å– CSV æª”æ¡ˆï¼š", error);
        }
    }

    // åˆå§‹åŒ–ç¨‹åº
    async function init() {
        await loadCSVFromFile('senior_7000.csv'); // å‡è¨­ CSV æª”æ¡ˆåç¨±ç‚º 
        if (words.length === 0) {
            alert("ç„¡æ³•è¼‰å…¥å–®å­—è³‡æ–™ï¼Œè«‹æª¢æŸ¥ CSV æª”æ¡ˆï¼");
        }
    }
	    
        function selectOption(option) {
            if (option === 1) {
                document.querySelector('.menu').style.display = 'none';
                document.getElementById('quiz-container').style.display = 'block';
            } else if (option === 2) {
                alert('å·²é€€å‡ºï¼Œæ„Ÿè¬ä½¿ç”¨ï¼');
            }
        }

        function chooseQuizType(type) {
            quizType = type;
            document.getElementById('quiz-container').style.display = 'none';
            document.getElementById('question-container').style.display = 'block';
        }

        function startQuiz() {
            const countInput = document.getElementById('question-count');
            totalQuestions = parseInt(countInput.value, 10);

            if (!totalQuestions || totalQuestions < 1 || totalQuestions > words.length) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„é¡Œæ•¸ï¼');
                return;
            }
	    // éš¨æ©Ÿæ‰“äº‚ words é™£åˆ—
    	words = words.sort(() => Math.random() - 0.5);
            currentQuestionIndex = 0;
            document.getElementById('question-container').style.display = 'none';
            document.getElementById('quiz').style.display = 'block';
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex >= totalQuestions) {
                document.getElementById('question').textContent = "æ¸¬é©—çµæŸï¼";
                document.getElementById('answers').innerHTML = "";
                document.getElementById('next-btn').style.display = 'none';
                document.getElementById('return-btn').style.display = 'block';
                return;
            }

            const questionElement = document.getElementById("question");
            const answersElement = document.getElementById("answers");
            const resultElement = document.getElementById("result");
            const nextButton = document.getElementById("next-btn");

            // æ¸…é™¤èˆŠå…§å®¹
            answersElement.innerHTML = "";
            resultElement.innerHTML = "";
            nextButton.style.display = "none";

            // å–å¾—ç•¶å‰é¡Œç›®
            const currentWord = words[currentQuestionIndex];

            if (quizType === 'multiple-choice') {
                // é¡¯ç¤ºé¸æ“‡é¡Œ
                questionElement.style.fontSize = '2em'; // è¨­å®šæ–‡å­—å¤§å°
                questionElement.textContent = `å–®å­—: ${currentWord.word} çš„æ„æ€æ˜¯ä»€éº¼ï¼Ÿ`;

                const options = [
                    currentWord.meaning,
                    ...words
                        .filter((_, index) => index !== currentQuestionIndex)
                        .sort(() => Math.random() - 0.5)
                        .slice(0, 3)
                        .map(word => word.meaning)
                ].sort(() => Math.random() - 0.5);

                options.forEach(option => {
                    const button = document.createElement("button");
                    button.textContent = option;
                    button.onclick = () => checkAnswer(option, currentWord.meaning);
                    answersElement.appendChild(button);
                });
            } else if (quizType === 'fill-in-the-blank') {
                // é¡¯ç¤ºå¡«ç©ºé¡Œ
                questionElement.style.fontSize = '2em'; // è¨­å®šæ–‡å­—å¤§å°
                questionElement.textContent = `è«‹è¼¸å…¥å–®å­—: ${currentWord.meaning}`;
                const input = document.createElement('input');
                input.type = 'text';
                input.style.width = '100%';
                input.id = 'fill-answer';
                answersElement.appendChild(input);

                const button = document.createElement("button");
                button.textContent = 'æäº¤ç­”æ¡ˆ';
                button.onclick = () => {
                    const userAnswer = document.getElementById('fill-answer').value.trim();
                    checkAnswer(userAnswer, currentWord.word);
                };
                answersElement.appendChild(button);
            }
        }

        function checkAnswer(selectedAnswer, correctAnswer) {
            const resultElement = document.getElementById("result");
            const nextButton = document.getElementById("next-btn");

            if (selectedAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                resultElement.textContent = "æ­£ç¢ºï¼ğŸ‰";
                resultElement.style.color = "green";
            } else {
                resultElement.textContent = `éŒ¯èª¤ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${correctAnswer}`;
                resultElement.style.color = "red";
            }

            nextButton.style.display = "block";
            nextButton.onclick = () => {
                currentQuestionIndex++;
                loadQuestion();
            };
        }

        function returnToMenu() {
            document.getElementById('quiz').style.display = 'none';
            document.querySelector('.menu').style.display = 'block';
        }
	window.onload = init;
    </script>
</body>
</html>
